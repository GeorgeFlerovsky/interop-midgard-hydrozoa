%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Latex macro improvements
% \usepackage{etoolbox}
\usepackage{ifthen}
%\usepackage{xifthen}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Page layout
\usepackage[top=2.0cm,left=2.0cm,right=2.0cm,bottom=3.5cm]{geometry}

% Chill out on the ``Overfull \hbox'' warnings.
\hfuzz=0.8em

% Separation between columns
\setlength{\columnsep}{0.8cm}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Multiple columns
\usepackage{multicol}

% Figure inside a multicol environment
\newenvironment{figure-multicol}
  {\par\vspace{1.5em}\noindent\minipage{\linewidth}\center}
  {\endminipage\par\vspace{1.5em}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Color
\usepackage{xcolor}
\definecolor{inline-code-dark-red}{HTML}{9a2626}
\definecolor{link-blue}{HTML}{074db5}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Line and paragraph spacing
\usepackage{setspace}
\linespread{1.08}

\usepackage[
  skip = 0em,
  indent = 1.4em
  % skip=0.8em plus 0.8em minus 0.3em,
  % indent = 0em
]{parskip}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Math
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{mathtools}

% Math font
\usepackage{notomath}

\usepackage{microtype}

% \usepackage{latexsym}

% Programming language semantics
\usepackage{semantic}
\setpremisesspace{1.8em}

% Theorems
\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]
\newtheorem{property}{Property}[section]
\newtheorem{lemma}[definition]{Lemma}
\newtheorem{theorem}[definition]{Theorem}
\newtheorem{corollary}[definition]{Corollary}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Hyphenation
\usepackage{hyphenat}

% Preserve the old \texttt behaviour
\DeclareRobustCommand\ttfamily
        {\not@math@alphabet\ttfamily\mathtt
         \fontfamily\ttdefault\selectfont\hyphenchar\font=-1\relax}

% Create a new version of \texttt that hyphenates.
\DeclareTextFontCommand{\mytexttt}{\ttfamily\hyphenchar\font=45\relax}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Arrays and tabular typesetting
\usepackage{array}
\usepackage{booktabs}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Bullets and numbered lists
\usepackage{enumerate}

\usepackage{enumitem}
\setlist{topsep = 0.5em, noitemsep}
\setlist[1]{labelindent = \parindent, leftmargin = 2\parindent}
% \setlist[description]{}
% \setlist[itemize]{}
% \setlist[enumerate]{}

% Inline lists within paragraphs
% \usepackage{paralist}

% multi-column lists
\newenvironment{itemize-multi}[1][2]%
{\begin{multicols}{#1}\raggedcolumns\begin{itemize}}%
{\end{itemize}\end{multicols}}

\newenvironment{enumerate-multi}[1][2]%
{\begin{multicols}{#1}\raggedcolumns\begin{enumerate}}%
{\end{enumerate}\end{multicols}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Inline code
% styled with monospaced font in dark red color
\newcommand{\code}[1]{\textcolor{inline-code-dark-red}{\mytexttt{#1}}}
\newcommand{\codeNC}[1]{\texttt{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Code blocks
\usepackage{listings}
\lstset{
  basicstyle=\ttfamily,
  mathescape,
  backgroundcolor=\color{gray!20},
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% References, hyperlinks, and bibliography
\usepackage[hyphens]{url}
\usepackage[colon,square,numbers]{natbib}
\setcitestyle{aysep={}}

\usepackage[
  unicode = true,
  pdftex,
  pdfa,
  colorlinks = true
]{hyperref}
\usepackage{hyperxmp}
\hypersetup{
  breaklinks = true,
  linkcolor = {link-blue},
  citecolor = {link-blue},
  urlcolor = {link-blue},
  pdfcreator=pdfLatex,
  pdfapart = 1,
  pdfaconformance = B,
}

\usepackage[nameinlink]{cleveref}
\crefname{part}{\S}{\S\S}
\crefname{chapter}{\S}{\S\S}
\crefname{section}{\S}{\S\S}
\crefname{subsection}{\S}{\S\S}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Figures and tables
\usepackage{float}
\floatstyle{boxed}
\restylefloat{figure}

\newenvironment{ruledfigure}[1]{\begin{figure}[#1]}{\end{figure}}

% Captions
\usepackage[
  justification = centering,
  labelsep = none,
  font = sc
  ]{caption}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Rotated text
\usepackage{rotating}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Boxes for notes, tips, warnings, cautions, exclamations
\usepackage{awesomebox}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Place a TODO marker at the page margin
\newcommand{\todo}{
    \marginpar{
        \begin{tikzpicture}
            \node[signal, xscale = -1, fill = orange!35]
                {\reflectbox{\large\textbf{TODO}}};
        \end{tikzpicture}
    }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Title block
\renewcommand{\maketitle}{\bgroup\setlength{\parindent}{0pt}
\begin{flushleft}
  \@title\vspace{0.4cm}

  \@date\vspace{0.4cm}
  
  \@author\vspace{0.8cm}
\end{flushleft}\egroup
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Abstract
\usepackage{abstract}
% \renewcommand{\abstractname}{}    % clear the title
% \renewcommand{\absnamepos}{empty} % originally center

\renewenvironment{abstract}%
 {\small%
  \begin{center}%
  \bfseries \abstractname\vspace{-.5em}\vspace{0pt}%
  \end{center}%
  \list{}{%
    \setlength{\leftmargin}{2.5\leftmargin}%
    \setlength{\rightmargin}{\leftmargin}%
  }%
  \item\relax}%
    {\endlist\vspace{0.5cm}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Copyright notice at bottom of page
\usepackage[
  type={CC},
  modifier={by-sa},
  version={4.0},
]{doclicense}

\newcommand{\copyrightnotice}{%
\footnotesize%
\doclicenseLongText%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Git revision info

\usepackage{gitinfo2}

% Lifted from gitinfo2
\renewcommand{\gitMarkPref}{}
\IfEq{\gitDirty}{}{}{%
  \renewcommand{\gitMarkPref}{[Dirty]~}
}%

\newcommand{\gitBranchHash}{Branch:~\gitBranch~@~\gitAbbrevHash{}~}

\newcommand{\gitReleaseDate}{%
  \IfEq{\gitRel}{}{%
    Commit date:~\gitAuthorDate%
  }{%
    Release:~\gitRel~(\gitAuthorDate)%
  }%
}

\newcommand{\gitWatermark}{%
\footnotesize\color{gray}%
\gitMarkPref%
\gitBranchHash%
\textbullet{}~%
\gitReleaseDate%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Fancy headers
\usepackage{fancyhdr}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}%
\fancyfoot[C]{\thepage}
\fancyfoot[R]{\\[2em]\gitWatermark}

\pagestyle{fancy}

\fancypagestyle{firstpagestyle}{
  \fancyhf{}
  \fancyfoot[C]{\thepage}
  \fancyfoot[R]{\\[1em]\copyrightnotice\\\gitWatermark}
}

% Custom headings
\usepackage{titlesec} 
\titleformat{\subsection}{\normalfont\large\bfseries\scshape}{\thesubsection}{1em}{}
